import os
import asyncio
import platform
import shutil
from langchain_core.tools import tool
try:
    from tools.utilities.report import format_industrial_result
except ImportError:
    def format_industrial_result(tool_name, status, **kwargs):
        return f"Tool: {tool_name}, Status: {status}, Data: {kwargs}"

# Singularity Exploitation Modules (Unified)
from .host_exploitation import *
from .identity_exploitation import *
from .infrastructure_exploitation import *
from .c2_infrastructure import *
from .situational_awareness import *
from .api_prober import *
from .graphql_prober import *
from .evasion_generators import *

# Weaponization Apex
from .payload_generation import *
from .process_injection import *
from .syscall_factory import *
from .clr_engineering import *
from .polyglot_payloads import *

@tool
async def exploitation_arsenal_health_check() -> str:
    """
    Performs a diagnostic of the Exploitation Arsenal, verifying OS-native tool dependencies.
    Checks for: adb, gdb, nmcli/netsh, and powershell.
    """
    try:
        critical_bins = ["adb", "gdb", "powershell" if platform.system() == "Windows" else "pwsh"]
        if platform.system() == "Linux":
            critical_bins.extend(["nmcli", "iwlist"])
            
        bin_status = {}
        for b in critical_bins:
            path = shutil.which(b)
            bin_status[b] = "AVAILABLE" if path else "MISSING"

        health_report = {
            "os": platform.system(),
            "dependencies": bin_status,
            "architecture": platform.machine(),
            "is_admin": "YES" if (os.name == 'nt' and os.access("C:\\Windows\\System32", os.W_OK)) or (os.name != 'nt' and os.getuid() == 0) else "NO"
        }

        return format_industrial_result(
            "exploitation_arsenal_health_check",
            "Audit Complete",
            confidence=1.0,
            impact="LOW",
            raw_data=health_report,
            summary="Exploitation arsenal health scan finished. Verify missing binaries for specific platform exploitation."
        )
    except Exception as e:
        return format_industrial_result("exploitation_arsenal_health_check", "Error", error=str(e))
